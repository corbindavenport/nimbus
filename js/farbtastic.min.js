jQuery.fn.farbtastic=function(t){return $.farbtastic(this,t),this},jQuery.farbtastic=function(t,e){var t=$(t).get(0);return t.farbtastic||(t.farbtastic=new jQuery._farbtastic(t,e))},jQuery._farbtastic=function(t,e){var a=this;$(t).html('<div class="farbtastic"><div class="color"></div><div class="wheel"></div><div class="overlay"></div><div class="h-marker marker"></div><div class="sl-marker marker"></div></div>');var o=$(".farbtastic",t);a.wheel=$(".wheel",t).get(0),a.radius=84,a.square=100,a.width=194,navigator.appVersion.match(/MSIE [0-6]\./)&&$("*",o).each(function(){if("none"!=this.currentStyle.backgroundImage){var t=this.currentStyle.backgroundImage;t=this.currentStyle.backgroundImage.substring(5,t.length-2),$(this).css({backgroundImage:"none",filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=true, sizingMethod=crop, src='"+t+"')"})}}),a.linkTo=function(t){return"object"==typeof a.callback&&$(a.callback).unbind("keyup",a.updateValue),a.color=null,"function"==typeof t?a.callback=t:("object"==typeof t||"string"==typeof t)&&(a.callback=$(t),a.callback.bind("keyup",a.updateValue),a.callback.get(0).value&&a.setColor(a.callback.get(0).value)),this},a.updateValue=function(){this.value&&this.value!=a.color&&a.setColor(this.value)},a.setColor=function(t){var e=a.unpack(t);return a.color!=t&&e&&(a.color=t,a.rgb=e,a.hsl=a.RGBToHSL(a.rgb),a.updateDisplay()),this},a.setHSL=function(t){return a.hsl=t,a.rgb=a.HSLToRGB(t),a.color=a.pack(a.rgb),a.updateDisplay(),this},a.widgetCoords=function(t){var e,o,r=t.target||t.srcElement,s=a.wheel;if("undefined"!=typeof t.offsetX){for(var n={x:t.offsetX,y:t.offsetY},u=r;u;)u.mouseX=n.x,u.mouseY=n.y,n.x+=u.offsetLeft,n.y+=u.offsetTop,u=u.offsetParent;for(var u=s,i={x:0,y:0};u;){if("undefined"!=typeof u.mouseX){e=u.mouseX-i.x,o=u.mouseY-i.y;break}i.x+=u.offsetLeft,i.y+=u.offsetTop,u=u.offsetParent}for(u=r;u;)u.mouseX=void 0,u.mouseY=void 0,u=u.offsetParent}else{var n=a.absolutePosition(s);e=(t.pageX||0*(t.clientX+$("html").get(0).scrollLeft))-n.x,o=(t.pageY||0*(t.clientY+$("html").get(0).scrollTop))-n.y}return{x:e-a.width/2,y:o-a.width/2}},a.mousedown=function(t){document.dragging||($(document).bind("mousemove",a.mousemove).bind("mouseup",a.mouseup),document.dragging=!0);var e=a.widgetCoords(t);return a.circleDrag=2*Math.max(Math.abs(e.x),Math.abs(e.y))>a.square,a.mousemove(t),!1},a.mousemove=function(t){var e=a.widgetCoords(t);if(a.circleDrag){var o=Math.atan2(e.x,-e.y)/6.28;0>o&&(o+=1),a.setHSL([o,a.hsl[1],a.hsl[2]])}else{var r=Math.max(0,Math.min(1,-(e.x/a.square)+.5)),s=Math.max(0,Math.min(1,-(e.y/a.square)+.5));a.setHSL([a.hsl[0],r,s])}return!1},a.mouseup=function(){$(document).unbind("mousemove",a.mousemove),$(document).unbind("mouseup",a.mouseup),document.dragging=!1},a.updateDisplay=function(){var t=6.28*a.hsl[0];$(".h-marker",o).css({left:Math.round(Math.sin(t)*a.radius+a.width/2)+"px",top:Math.round(-Math.cos(t)*a.radius+a.width/2)+"px"}),$(".sl-marker",o).css({left:Math.round(a.square*(.5-a.hsl[1])+a.width/2)+"px",top:Math.round(a.square*(.5-a.hsl[2])+a.width/2)+"px"}),$(".color",o).css("backgroundColor",a.pack(a.HSLToRGB([a.hsl[0],1,.5]))),"object"==typeof a.callback?$(a.callback).each(function(){this.value&&this.value!=a.color&&(this.value=a.color)}):"function"==typeof a.callback&&a.callback.call(a,a.color)},a.absolutePosition=function(t){var e={x:t.offsetLeft,y:t.offsetTop};if(t.offsetParent){var o=a.absolutePosition(t.offsetParent);e.x+=o.x,e.y+=o.y}return e},a.pack=function(t){var e=Math.round(255*t[0]),a=Math.round(255*t[1]),o=Math.round(255*t[2]);return"#"+(16>e?"0":"")+e.toString(16)+(16>a?"0":"")+a.toString(16)+(16>o?"0":"")+o.toString(16)},a.unpack=function(t){return 7==t.length?[parseInt("0x"+t.substring(1,3))/255,parseInt("0x"+t.substring(3,5))/255,parseInt("0x"+t.substring(5,7))/255]:4==t.length?[parseInt("0x"+t.substring(1,2))/15,parseInt("0x"+t.substring(2,3))/15,parseInt("0x"+t.substring(3,4))/15]:void 0},a.HSLToRGB=function(t){var e,a,o=t[0],r=t[1],s=t[2];return a=.5>=s?s*(r+1):s+r-s*r,e=2*s-a,[this.hueToRGB(e,a,o+.33333),this.hueToRGB(e,a,o),this.hueToRGB(e,a,o-.33333)]},a.hueToRGB=function(t,e,a){return a=0>a?a+1:a>1?a-1:a,1>6*a?t+(e-t)*a*6:1>2*a?e:2>3*a?t+(e-t)*(.66666-a)*6:t},a.RGBToHSL=function(t){var e,a,o,r,s,n,u=t[0],i=t[1],c=t[2];return e=Math.min(u,Math.min(i,c)),a=Math.max(u,Math.max(i,c)),o=a-e,n=(e+a)/2,s=0,n>0&&1>n&&(s=o/(.5>n?2*n:2-2*n)),r=0,o>0&&(a==u&&a!=i&&(r+=(i-c)/o),a==i&&a!=c&&(r+=2+(c-u)/o),a==c&&a!=u&&(r+=4+(u-i)/o),r/=6),[r,s,n]},$("*",o).mousedown(a.mousedown),a.setColor("#000000"),e&&a.linkTo(e)};